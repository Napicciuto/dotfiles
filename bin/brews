#!/usr/bin/env ruby
require 'json'

`brew list`.split.each do |brew|
  name = brew
  receipt_path = Dir.glob("#{`brew --prefix`.chomp}/Cellar/#{brew}/**/INSTALL_RECEIPT.json").first
  receipt = JSON.load(File.open(receipt_path))
  options = receipt['used_options'].join(' ')
  puts "#{name} #{options unless options.empty?}"
end
